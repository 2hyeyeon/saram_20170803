{"changed":true,"filter":false,"title":"DetailReportView.js","tooltip":"/public/js/views/rm/DetailReportView.js","value":"define([\n  'jquery',\n  'underscore',\n  'backbone',\n  'animator',\n  'core/BaseView',\n  'dialog',\n  'text!templates/report/addReportTemplate.html',\n  'models/rm/ApprovalModel',\n  'models/vacation/OutOfficeModel',\n  'collection/rm/ApprovalCollection',\n], function($, _, Backbone, animator, BaseView, Dialog, addReportTmp, ApprovalModel, OutOfficeModel, ApprovalCollection){\n  var detailReportView = BaseView.extend({\n    options : {},\n   \n  \tevents: {\n  \t},\n  \t\n  \tinitialize:function(){\n  \t\t$(this.el).html();\n\t    $(this.el).empty();\n  \t},\n  \t\n    render: function(el){\n  \t    var dfd= new $.Deferred();\n  \t        \n        if (!_.isUndefined(el)){\n\t        this.el=el;\n  \t    }\n        $(this.el).append(addReportTmp);\n\t    \n  \t     // title setting\n        this.setTitleTxt();\n        // default display setting\n        this.setAddReportDisplay(this.options);\n        dfd.resolve();\n  \t    \n  \t    return dfd.promise();\n    },\n    \n    setTitleTxt : function(){\n      // small title \n      var smallTitleTxt = $(this.el).find('#smallTitleTxt');\n      smallTitleTxt.empty();\n      smallTitleTxt.text('상세보기');\n      \n      return this;\n    },\n    \n    setAddReportDisplay : function(param){\n      // table Setting\n      this.setTableDisplay();\n      // select box data setting\n      this.setDataDefaultValues(param);\n      // display setting\n      this.setDefaultDisplay();\n    },\n    \n    setTableDisplay : function() {\n      var tableTr = $(this.el).find('.apployReportNone');\n      tableTr.css('display','none');\n    },\n    setDefaultDisplay : function() {\n      \n      var disableValues = ['submit_id', 'start_date', 'end_date', 'office_code', 'submit_comment', 'manager_id', 'state', 'decide_comment'];\n      \n      for(var dvI=0; dvI<disableValues.length; dvI++){\n        $(this.el).find('#' + disableValues[dvI]).attr('readonly',true);\n        $(this.el).find('#' + disableValues[dvI]).attr('disabled',true);\n      }\n      \n      $(this.el).find('#start_date input').attr('readonly',true);\n      $(this.el).find('#end_date input').attr('readonly',true);\n      \n      $(this.el).find('#start_date input').attr('disabled',true);\n      $(this.el).find('#end_date input').attr('disabled',true);\n      \n      $(this.el).find('#start_time input').attr('readonly',true);\n      $(this.el).find('#end_time input').attr('readonly',true);\n      \n      $(this.el).find('#start_time input').attr('disabled',true);\n      $(this.el).find('#end_time input').attr('disabled',true);\n      \n      $(this.el).find('#usableHolidayCon').css('display','none');\n    \n    },\n    \n    setDataDefaultValues : function(param){\n      // console.log(param);\n      var _this = $(this.el);\n      if(param != undefined){\n        _this.find('#submit_id').val(param.submit_name);\n        _this.find('#start_date input').val(param.start_date);\n        _this.find('#end_date input').val(param.end_date);\n        _this.find('#start_time input').val(param.start_time);\n        _this.find('#end_time input').val(param.end_time);\n        _this.find('#office_code').html(\"<option>\"+param.office_code_name+\"</option>\");\n        _this.find('#submit_comment').val(param.submit_comment);\n        _this.find('#decide_comment').val(param.decide_comment);\n        \n        _this.find('#manager_id').html(\"<option>\"+param.manager_name+\"</option>\");\n        _this.find('#state').html(\"<option>\"+param.state+\"</option>\");\n\n        var usable = (param.total_day > param.used_holiday)?param.total_day - param.used_holiday : 0;\n        _this.find('#usableHoliday').val(usable + \" 일\");\n        \n        var holReq = \"0\";\n        if(param.office_code == \"B01\"){\n          // 휴일근무\n          holReq = \"0\";\n          $(this.el).find('#end_date').css('display','none');\n          $(this.el).find('#outsideOfficeTimeCon').css('display','none');\n        }else if(param.office_code == \"V02\" || param.office_code == \"V03\"){\n          // 반차\n          holReq = \"0.5\";\n          $(this.el).find('#end_date').css('display','none');\n          $(this.el).find('#outsideOfficeTimeCon').css('display','none');\n        }else if(param.office_code == \"W01\"){\n          // 외근\n          holReq = \"0\";\n          $(this.el).find('#end_date').css('display','none');\n          $(this.el).find('#outsideOfficeTimeCon').css('display','block');\n        }else {\n          var arrInsertDate = this.getDatePariod();\n          holReq = arrInsertDate.length + \"\";\n          $(this.el).find('#end_date').css('display','table');\n          $(this.el).find('#outsideOfficeTimeCon').css('display','none');\n        }\n        _this.find('#reqHoliday').val(holReq + \" 일\");\n        \n        if(holReq == \"0\"){\n          // _this.find('#reqHoliday').val(holReq + \" 일\");\n          $(this.el).find('#reqHoliday').parent().parent().css('display', 'none');\n        }\n      }\n    },\n    \n    getDatePariod : function(){\n       // 날짜 개수 이용하여 날짜 구하기\n      var sStart = $(this.el).find('#start_date input').val();\n      var sEnd = $(this.el).find('#end_date input').val();\n      \n      var start = new Date(sStart.substr(0,4),sStart.substr(5,2)-1,sStart.substr(8,2));\n      var end = new Date(sEnd.substr(0,4),sEnd.substr(5,2)-1,sEnd.substr(8,2));\n      var day = 1000*60*60*24;\n      \n      var compareVal = parseInt((end - start)/day);\n      var arrInsertDate = [];\n      var holidayInfos = this.options.holidayInfos;\n      if(compareVal > 0){\n        // 차이\n        for(var i=0; i<=compareVal; i++){\n          var dt = start.valueOf() + (i*day);\n          var resDate = new Date(dt);\n          if(resDate.getDay() != 0 && resDate.getDay() != 6){\n            // 주말이 아닌 날짜\n            var isPush = true;\n            for(var j=0; j<holidayInfos.length; j++){\n              var sDate = this.getDateFormat(resDate);\n              if(holidayInfos[j].date == sDate){\n                isPush = false;\n                break;\n              }\n            }\n            if(isPush){\n              arrInsertDate.push(sDate);\n            }\n          }\n        }\n       \n      } else {\n         if(start.getDay() != 0 && start.getDay() != 6){\n            // 주말이 아닌 날짜\n           for(var k=0; k<holidayInfos.length; k++){\n              if(holidayInfos[k].date != sStart){\n                arrInsertDate.push(sStart);\n                break;\n              }\n           }\n        }\n      }\n      \n      return arrInsertDate;\n    },\n    \n    getDateFormat : function(dateData){\n      var sDateFormat = \"\";\n      if (dateData == null){\n        sDateFormat = \"\";\n      }else {\n        sDateFormat\n        = dateData.getFullYear() + \"-\" + this.getzFormat(dateData.getMonth() + 1, 2) + \"-\" + this.getzFormat(dateData.getDate(), 2);\n      }\n      return sDateFormat;\n    },\n    \n    getzFormat: function(s, len){\n      var sZero = \"\";\n      s = s + \"\";\n      if(s.length < len){\n        for(var i = 0; i < (len-s.length); i++){\n          sZero += \"0\";\n        }\n      }\n      return sZero + s;\n    },\n    \n    onClickBtnAppCancel : function(stateVal){\n  \t  this.thisDfd = new $.Deferred();\n  \t  var _this = this;\n  \t  \n      var formData = this.options;\n      \n      console.log(formData);\n      formData[\"_id\"] = this.options[\"doc_num\"];\n      formData[\"state\"] = stateVal;\n      \n      var _appCollection = new ApprovalCollection();\n      _appCollection.url = \"/approval/info\";\n      var _thisData = {doc_num : this.options[\"doc_num\"]};\n      \n      _appCollection.fetch({\n     \t\t\treset : true, \n     \t\t\tdata: _thisData,\n     \t\t\terror : function(result) {\n     \t\t\t\tDialog.error(\"데이터 조회가 실패했습니다.\");\n     \t\t\t\t_this.thisDfd.reject();\n     \t\t\t}\n     \t\t})\n        .done(function(result){\n            var resultVal = result[0].state;\n            if(resultVal == '상신' || stateVal != '상신취소'){\n                var approvalCollection = new ApprovalCollection(formData);\n                approvalCollection.idAttribute = \"doc_num\";\n                approvalCollection.save({}, _this.options[\"doc_num\"]).then(function(){\n                  // console.log(\"SUCCESS UPDATE APPROVAL!!!!!!!\");\n                  _this.thisDfd.resolve(formData);\n                }, function(model,xhr, options){\n                  var respons=xhr.responseJSON;\n                  Dialog.error(respons.message);\n                  _this.thisDfd.reject();\n                });\n            } else {\n                Dialog.error(\"결재가 완료된 항목입니다.\");\n                _this.thisDfd.reject({div_fail : true});\n            }\n\n        });\n     \n       return _this.thisDfd.promise();\n    \n      // // this.collection\n    }\n    \n  });\n  return detailReportView;\n});","undoManager":{"mark":-1,"position":1,"stack":[[{"group":"doc","deltas":[{"start":{"row":170,"column":7},"end":{"row":170,"column":8},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":170,"column":12},"end":{"row":170,"column":13},"action":"insert","lines":[" "]}]}]]},"ace":{"folds":[],"scrolltop":2845,"scrollleft":0,"selection":{"start":{"row":234,"column":72},"end":{"row":234,"column":72},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":202,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1429591467614}