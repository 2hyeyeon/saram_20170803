{"changed":true,"filter":false,"title":"RawDataView.js","tooltip":"/public/js/views/RawData/RawDataView.js","value":"define([\n  'jquery',\n  'underscore',\n  'backbone',\n  'core/BaseView',\n  'grid',\n  'schemas',\n  'util',\n  'dialog',\n  'csvParser',\n  'cmoment',\n  'code',\n  'i18n!nls/common',\n  'text!templates/default/head.html',\n  'text!templates/default/content.html',\n  'text!templates/layout/default.html',\n  'text!templates/default/row.html',\n  'text!templates/default/rowdatepickerRange.html',\n  'text!templates/default/rowbuttoncontainer.html',\n  'text!templates/default/rowbutton.html',\n  'text!templates/default/rowcombo.html',\n  'models/sm/SessionModel',\n  'models/common/RawDataModel',\n  'collection/common/RawDataCollection',\n  'models/sm/UserModel',\n  'collection/sm/UserCollection',\n  'views/component/ProgressbarView',\n], function($, _, Backbone, BaseView, Grid, Schemas, Util, Dialog, csvParser, Moment, Code, i18nCommon,\nHeadHTML, ContentHTML, LayoutHTML, RowHTML, DatePickerHTML, RowButtonContainerHTML, RowButtonHTML, RowComboHTML,\nSessionModel, RawDataModel, RawDataCollection,UserModel, UserCollection,\nProgressbarView){\n    var RawDataView = BaseView.extend({\n        el:$(\".main-container\"),\n        \n    \tinitialize:function(){\n    \t\t$(this.el).html('');\n    \t    $(this.el).empty();\n    \t    this.rawDataCollection = new RawDataCollection();\n    \n            this.departmentCollection = null;\n            this.userCollection = new UserCollection();\n            this.userCollection.fetch();\n            \n            this.gridOption = {\n    \t\t    el:\"rawDataContent\",\n    \t\t    id:\"rawDataTable\",\n    \t\t    column:[\n    \t\t         \t{ data : \"department\", \t\t\"title\" : i18nCommon.RAW_DATA_LIST.GRID_COL_NAME.DEPARTMENT },\n   \t                   \t{ data : \"name\", \t\t\t\"title\" : i18nCommon.RAW_DATA_LIST.GRID_COL_NAME.NAME },\n \t                   \t{ data : \"char_date\", \t\t\"title\" : i18nCommon.RAW_DATA_LIST.GRID_COL_NAME.TIME },\n \t                   \t{ data : \"type\", \t\t\t\"title\" : i18nCommon.RAW_DATA_LIST.GRID_COL_NAME.TYPE }\n    \t\t    ],\n    \t\t    dataschema:[\"name\", \"department\", \"char_date\", \"type\"],\n    \t\t    collection:this.rawDataCollection,\n    \t\t    detail: true,\n    \t\t    fetch: false,\n    \t\t    buttons:[\"search\",{\n        \t\t    \ttype:\"myRecord\",\n\t\t\t\t        name: \"myRecord\",\n\t\t\t\t        filterColumn:[\"name\"], //필터링 할 컬럼을 배열로 정의 하면 자신의 아이디 또는 이름으로 필터링 됨. dataschema 에 존재하는 키값.\n\t\t\t\t        tooltip: \"\",\n        \t\t    }],\n                order: [[3, \"desc\"]]\n        \t\t    \n    \t\t};\n\n            var dept_code = SessionModel.getUserInfo().dept_code;\n            var admin = SessionModel.getUserInfo().admin;\n            \n            // 경영지원 팀 인 경우\n            if ( dept_code == '1000' || admin == 1 ) {\n            \tthis.gridOption.column.push( { data : \"ip_office\", \t\t\"title\" : i18nCommon.RAW_DATA_LIST.GRID_COL_NAME.IP } );\n            \tthis.gridOption.column.push( { data : \"mac\",\t\t\"title\" : i18nCommon.RAW_DATA_LIST.GRID_COL_NAME.MAC } );\n            }\n\n            // 경영 지원팀 또는 수원 사업자의 경우 컬럼을 추가\n            if ( dept_code == '1000' || Code.isSuwonWorker(dept_code) || admin == 1) {\n            \tthis.gridOption.column.push( { data : \"need_confirm\", \t\"title\" : i18nCommon.RAW_DATA_LIST.GRID_COL_NAME.NEED_CONFIRM,\n            \t\trender: function(data, type, full, meta) {\n               \t\t\treturn (full.need_confirm == 1)? i18nCommon.RAW_DATA_LIST.MSG.OK : i18nCommon.RAW_DATA_LIST.MSG.NOK ;\n               \t\t}\n               \t});\n            }\n            \n    \t},\n        getRawData : function(){\n            var startDate = Moment($(this.el).find(\"#rdFromDatePicker\").data(\"DateTimePicker\").getDate().toDate());\n            var endDate = Moment($(this.el).find(\"#rdToDatePicker\").data(\"DateTimePicker\").getDate().toDate());\n            var deptCode = $(this.el).find(\"#rdCombo\").val();\n            if(endDate.diff(startDate, 'days') > 92){\n                Dialog.warning(\"검색 기간이 초과되었습니다. (최대 3개월)\");\n            }else{\n                this.renderTable(startDate, endDate, deptCode);\n            }\n        },\n        renderTable : function(startDate, endDate,deptCode){\n            var that = this;\n            Dialog.loading({\n                action:function(){\n                    var dfd = new $.Deferred();\n                    that.rawDataCollection.fetch({\n                        data : {start : startDate.format(\"YYYY-MM-DD\"), end : endDate.format(\"YYYY-MM-DD\"), dept : deptCode},\n                        success: function(){\n                            dfd.resolve();\n                        }, error: function(){\n                            dfd.reject();\n                        }\n            \t    });\n            \t    return dfd.promise();\n        \t    },\n        \t    \n                actionCallBack:function(res){//response schema\n                    that.grid.render();\n                },\n                errorCallBack:function(response){\n                    Dialog.error( i18nCommon.RAW_DATA_LIST.MSG.LOADING_FAIL );\n                },\n            });\n        },\n        \n    \trender:function(){\n    \t    var _view= this;\n    \t    var _headSchema=Schemas.getSchema('headTemp');\n    \t    var _headTemp=_.template(HeadHTML);\n    \t    var _layout=$(LayoutHTML);\n    \t    var _head=$(_headTemp(_headSchema.getDefault({\n\t            title:i18nCommon.RAW_DATA_LIST.TITLE,\n\t            subTitle:i18nCommon.RAW_DATA_LIST.SUB_TITLE })\n    \t    ));\n    \t    \n    \t    _head.addClass(\"no-margin\");\n    \t    _head.addClass(\"relative-layout\");\n    \t    \n    \t    var _content=$(ContentHTML).attr(\"id\", this.gridOption.el);\n    \t    var _row=$(RowHTML);\n    \t    var _datepickerRange=$(_.template(DatePickerHTML)(\n    \t    \t{ obj : \n    \t    \t\t{\n    \t    \t\t\tfromId : \"rdFromDatePicker\",\n    \t    \t\t\ttoId : \"rdToDatePicker\"\n    \t    \t\t}\n    \t    \t})\n    \t    );\n    \t    var _btnContainer = $(_.template(RowButtonContainerHTML)({\n    \t            obj: {\n    \t                id: \"rdBtnContainer\"\n    \t            }\n    \t        })\n    \t    );\n    \t    \n    \t    var _searchBtn = $(_.template(RowButtonHTML)({\n    \t            obj: {\n    \t                id: \"rdSearchBtn\",\n    \t                label: i18nCommon.RAW_DATA_LIST.SEARCH_BTN\n    \t            }\n    \t        })\n\t        );\n\t        \n\t        var _combo = $(_.template(RowComboHTML)({\n    \t            obj : {\n    \t                id : \"rdCombo\",\n    \t                label : \"부서\"\n    \t            }\n    \t        })\n\t        );\n    \t    \n\t        _searchBtn.click(function(e){\n\t            _view.getRawData();\n\t        });\n\t        \n\t        _btnContainer.append(_searchBtn);\n\t        \n    \t    _row.append(_datepickerRange);\n    \t    _row.append(_combo);\n    \t    _row.append(_btnContainer);\n            \n    \t    _layout.append(_head);\n    \t    _layout.append(_row);\n            _layout.append(_content);\n\n    \t    $(this.el).append(_layout);\n    \t    \n    \t    var today = new Date();\n    \t    $(this.el).find(\"#rdFromDatePicker\").datetimepicker({\n            \tpickTime: false,\n\t\t        language: \"ko\",\n\t\t        todayHighlight: true,\n\t\t        format: \"YYYY-MM-DD\",\n\t\t        defaultDate: Moment(today).add(-7,\"days\").format(\"YYYY-MM-DD\")\n            });\n            \n            $(this.el).find(\"#rdToDatePicker\").datetimepicker({\n            \tpickTime: false,\n\t\t        language: \"ko\",\n\t\t        todayHighlight: true,\n\t\t        format: \"YYYY-MM-DD\",\n\t\t        defaultDate: Moment(today).format(\"YYYY-MM-DD\")\n            });\n            \n            var dept = Code.getCodes(Code.DEPARTMENT);\n            $(this.el).find(\"#rdCombo\").append(\"<option>\"+\"전체\"+\"</option>\");\n     \t    for(var i=0; i < dept.length; i++){\n     \t        $(this.el).find(\"#rdCombo\").append(\"<option>\"+dept[i].name+\"</option>\");\n     \t    }\n     \t    $(this.el).find(\"#rdCombo\").val(SessionModel.getUserInfo().dept_name);\n     \t    \n    \t    var _gridSchema=Schemas.getSchema('grid');\n    \t    \n        \tthis.grid= new Grid(_gridSchema.getDefault(this.gridOption));\n            this.grid.render();\n            this.getRawData();\n            \n            return this;\n     \t},\n     \t\n    });\n    return RawDataView;\n});","undoManager":{"mark":42,"position":46,"stack":[[{"group":"doc","deltas":[{"start":{"row":88,"column":24},"end":{"row":88,"column":25},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":25},"end":{"row":88,"column":26},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":26},"end":{"row":88,"column":27},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":27},"end":{"row":88,"column":28},"action":"insert","lines":["$"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":28},"end":{"row":88,"column":30},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":29},"end":{"row":88,"column":30},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":30},"end":{"row":88,"column":31},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":31},"end":{"row":88,"column":32},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":32},"end":{"row":88,"column":33},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":33},"end":{"row":88,"column":34},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":34},"end":{"row":88,"column":35},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":35},"end":{"row":88,"column":36},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":37},"end":{"row":88,"column":38},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":37},"end":{"row":88,"column":38},"action":"remove","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":37},"end":{"row":88,"column":38},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":38},"end":{"row":88,"column":39},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":39},"end":{"row":88,"column":40},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":40},"end":{"row":88,"column":41},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":41},"end":{"row":88,"column":42},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":42},"end":{"row":88,"column":44},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":43},"end":{"row":88,"column":45},"action":"insert","lines":["\"\""]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":44},"end":{"row":88,"column":45},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":45},"end":{"row":88,"column":46},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":46},"end":{"row":88,"column":47},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":47},"end":{"row":88,"column":48},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":47},"end":{"row":88,"column":48},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":47},"end":{"row":88,"column":48},"action":"insert","lines":["C"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":48},"end":{"row":88,"column":49},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":49},"end":{"row":88,"column":50},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":50},"end":{"row":88,"column":51},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":51},"end":{"row":88,"column":52},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":52},"end":{"row":88,"column":53},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":53},"end":{"row":88,"column":54},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":53},"end":{"row":88,"column":54},"action":"remove","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":52},"end":{"row":88,"column":53},"action":"remove","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":54},"end":{"row":88,"column":55},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":55},"end":{"row":88,"column":56},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":56},"end":{"row":88,"column":57},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":57},"end":{"row":88,"column":58},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":58},"end":{"row":88,"column":60},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":60},"end":{"row":88,"column":61},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":46},"end":{"row":88,"column":47},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":46},"end":{"row":88,"column":47},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":198,"column":0},"end":{"row":199,"column":0},"action":"remove","lines":["            ",""]}]}],[{"group":"doc","deltas":[{"start":{"row":198,"column":0},"end":{"row":199,"column":0},"action":"remove","lines":["            console.log(SessionModel.getUserInfo());",""]}]}],[{"group":"doc","deltas":[{"start":{"row":197,"column":15},"end":{"row":198,"column":0},"action":"insert","lines":["",""]},{"start":{"row":198,"column":0},"end":{"row":198,"column":12},"action":"insert","lines":["            "]}]}],[{"group":"doc","deltas":[{"start":{"row":204,"column":0},"end":{"row":205,"column":0},"action":"remove","lines":["     \t    ",""]}]}]]},"ace":{"folds":[],"scrolltop":2696.5,"scrollleft":0,"selection":{"start":{"row":199,"column":12},"end":{"row":204,"column":80},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":337,"mode":"ace/mode/javascript"}},"timestamp":1429514404650}