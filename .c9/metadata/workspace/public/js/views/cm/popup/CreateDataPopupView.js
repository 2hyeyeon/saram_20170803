{"filter":false,"title":"CreateDataPopupView.js","tooltip":"/public/js/views/cm/popup/CreateDataPopupView.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":117,"column":36},"end":{"row":117,"column":37},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":36},"end":{"row":117,"column":37},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":35},"end":{"row":117,"column":36},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":35},"end":{"row":117,"column":36},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":36},"end":{"row":117,"column":37},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":37},"end":{"row":117,"column":38},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":38},"end":{"row":117,"column":39},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":39},"end":{"row":117,"column":70},"action":"insert","lines":["userModel.attributes.dept_name;"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":60},"end":{"row":117,"column":69},"action":"remove","lines":["dept_name"]},{"start":{"row":117,"column":60},"end":{"row":117,"column":73},"action":"insert","lines":["leave_company"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":24},"end":{"row":117,"column":36},"action":"remove","lines":["leaveCompany"]},{"start":{"row":117,"column":24},"end":{"row":117,"column":37},"action":"insert","lines":["leave_company"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":29},"end":{"row":117,"column":30},"action":"remove","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":29},"end":{"row":117,"column":30},"action":"remove","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":29},"end":{"row":117,"column":30},"action":"insert","lines":["C"]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":74},"end":{"row":118,"column":0},"action":"insert","lines":["",""]},{"start":{"row":118,"column":0},"end":{"row":118,"column":20},"action":"insert","lines":["                    "]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":39},"end":{"row":121,"column":114},"action":"remove","lines":["userModel.attributes.leave_company) && !_.isNull(userModel.attributes.lea))"]},{"start":{"row":121,"column":39},"end":{"row":121,"column":40},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":40},"end":{"row":121,"column":41},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":41},"end":{"row":121,"column":42},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":42},"end":{"row":121,"column":43},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":43},"end":{"row":121,"column":44},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":44},"end":{"row":121,"column":45},"action":"insert","lines":["C"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":45},"end":{"row":121,"column":46},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":46},"end":{"row":121,"column":47},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":47},"end":{"row":121,"column":48},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":48},"end":{"row":121,"column":49},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":49},"end":{"row":121,"column":50},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":50},"end":{"row":121,"column":51},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":51},"end":{"row":121,"column":52},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":52},"end":{"row":121,"column":53},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":52},"end":{"row":121,"column":53},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":27},"end":{"row":121,"column":28},"action":"remove","lines":["("]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":27},"end":{"row":121,"column":28},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":121,"column":50},"end":{"row":122,"column":0},"action":"insert","lines":["",""]},{"start":{"row":122,"column":0},"end":{"row":122,"column":24},"action":"insert","lines":["                        "]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":24},"end":{"row":122,"column":25},"action":"insert","lines":["|"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":25},"end":{"row":122,"column":26},"action":"insert","lines":["|"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":26},"end":{"row":122,"column":27},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":27},"end":{"row":122,"column":28},"action":"insert","lines":["!"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":28},"end":{"row":122,"column":29},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":28},"end":{"row":122,"column":29},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":28},"end":{"row":122,"column":29},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":29},"end":{"row":122,"column":30},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":29},"end":{"row":122,"column":30},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":28},"end":{"row":122,"column":29},"action":"remove","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":27},"end":{"row":122,"column":28},"action":"remove","lines":["!"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":27},"end":{"row":122,"column":28},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":28},"end":{"row":122,"column":29},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":29},"end":{"row":122,"column":30},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":30},"end":{"row":122,"column":31},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":31},"end":{"row":122,"column":32},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":32},"end":{"row":122,"column":33},"action":"insert","lines":["C"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":33},"end":{"row":122,"column":34},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":34},"end":{"row":122,"column":35},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":35},"end":{"row":122,"column":36},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":36},"end":{"row":122,"column":37},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":37},"end":{"row":122,"column":38},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":37},"end":{"row":122,"column":38},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":37},"end":{"row":122,"column":38},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":38},"end":{"row":122,"column":39},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":38},"end":{"row":122,"column":39},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":37},"end":{"row":122,"column":38},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":37},"end":{"row":122,"column":38},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":38},"end":{"row":122,"column":39},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":39},"end":{"row":122,"column":40},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":40},"end":{"row":122,"column":41},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":41},"end":{"row":122,"column":42},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":42},"end":{"row":122,"column":43},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":43},"end":{"row":122,"column":44},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":44},"end":{"row":122,"column":46},"action":"insert","lines":["\"\""]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":27},"end":{"row":122,"column":40},"action":"remove","lines":["leaveComapany"]},{"start":{"row":122,"column":27},"end":{"row":122,"column":39},"action":"insert","lines":["leaveCompany"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":195,"column":3},"action":"remove","lines":["define([ ","\t'jquery',","\t'underscore',","\t'backbone',","\t'util',","\t'cmoment',","\t'resulttimefactory',","\t'dialog',","\t'i18n!nls/common',","\t'lib/component/form',","\t'collection/common/HolidayCollection',","\t'collection/common/RawDataCollection',","\t'collection/sm/UserCollection',","\t'collection/cm/CommuteCollection',","\t'collection/vacation/OutOfficeCollection',","\t'collection/vacation/InOfficeCollection',","\t'text!templates/default/datepicker.html',","\t'text!templates/inputForm/label.html',","], function(","\t$, _, Backbone, Util, Moment, ResultTimeFactory, Dialog, i18nCommon, Form,","\tHolidayCollection, RawDataCollection, UserCollection, CommuteCollection, OutOfficeCollection, InOfficeCollection,","\tDatePickerHTML, LabelHTML",") {","\tvar resultTimeFactory = ResultTimeFactory.Builder;","\tvar ChangeHistoryPopupView = Backbone.View.extend({","\t\tinitialize : function(data) {","\t\t    if(_.isNull(data.date)){","\t\t\t    this.date = \"2015-01-01\";","\t\t    }else{","\t\t        this.date = Moment(data.date, ResultTimeFactory.DATEFORMAT).add(1,\"days\").format(ResultTimeFactory.DATEFORMAT);","\t\t    }","\t\t    ","\t\t  ","\t\t},","\t\trender : function(el) {","\t\t\tvar dfd= new $.Deferred();","            ","            if (!_.isUndefined(el)){","    \t        this.el=el;","    \t    }","    \t    var _view = this;","    \t    ","    \t    var _form = new Form({","    \t        el:_view.el,","    \t        form:undefined,","    \t         childs:[{","\t                type:\"date\",","\t                name:\"startDate\",","\t                label:i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.FORM.START_DATE,","\t                value: this.date,","\t                format:\"YYYY-MM-DD\",","\t                disabled:true,","    \t        }, {","\t                type:\"date\",","\t                name:\"endDate\",","\t                label:i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.FORM.END_DATE,","\t                format:\"YYYY-MM-DD\",","    \t        }, {","    \t        \ttype:\"text\",","    \t        \tname:\"memo\",","    \t        \tlabel:i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.FORM.TIP,","    \t        \tdisabled:true,","    \t        \tvalue: i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.FORM.TIP_TEXT","    \t        }]","    \t    });","    \t    ","    \t    _form.render().done(function(){","    \t        _view.form=_form;","    \t        dfd.resolve();","    \t    }).fail(function(){","    \t        dfd.reject();","    \t    });  ","\t    ","            return dfd.promise();","\t\t},","\t\tcreateData : function(){","    \t    var dfd = new $.Deferred();","    \t    ","    \t    var data = this.form.getData();","    \t    ","    \t    var resultCollection = new CommuteCollection();","    \t    var startDate = Moment(data.startDate, resultTimeFactory.DATEFORMAT);","            var endDate = Moment(data.endDate, resultTimeFactory.DATEFORMAT);","            var yesterday = Moment(startDate).subtract(1, 'days');","            ","            if(startDate.isAfter(endDate)){","                Dialog.error(i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.DATE_ERR_MSG);","                dfd.reject();","            }","            ","            var selectedDate = {","                start:startDate.format(ResultTimeFactory.DATEFORMAT),","                end:endDate.format(ResultTimeFactory.DATEFORMAT)","            };","            ","            var rawDataCollection = new RawDataCollection();            // 해당기간의 출입기록","            var userCollection = new UserCollection();                  // 전체 사용자 목록","            var holidayCollection = new HolidayCollection();            // 해당 연도 전체 휴일 목록","            var outOfficeCollection = new OutOfficeCollection();        // 휴가 / 외근 / 출장 목록","            var yesterdayCommuteCollection = new CommuteCollection();   // 선택일 전날 근태 데이터 목록","            var inOfficeCollection = new InOfficeCollection();","            ","            $.when(","                rawDataCollection.fetch({data: { start : selectedDate.start, end:Moment(endDate).add(1,\"days\").format(ResultTimeFactory.DATEFORMAT) }}),","                userCollection.fetch(),","                holidayCollection.fetch({ data : {  year : startDate.year() } }),","                outOfficeCollection.fetch({data : selectedDate}),","                inOfficeCollection.fetch({data : selectedDate}),","                yesterdayCommuteCollection.fetchDate(yesterday.format(ResultTimeFactory.DATEFORMAT))","            ).done(function(){","                var diff_days = endDate.diff(startDate, 'days');","","                _.each(userCollection.models, function(userModel, idx){     // 사용자별로 데이터 생성","                    var today = Moment(startDate);","                    var userId = userModel.attributes.id;","                    var userName = userModel.attributes.name;","                    var userDepartment = userModel.attributes.dept_name;","                    var leaveCompany = userModel.attributes.leave_company;","                    ","                    if( userDepartment == \"무소속\"","                        || userDepartment == \"임원\"","                        || !_.isNull(leaveCompany)","                        || leaveCompany == \"\"","                        || userName.slice(0,3) == \"테스트\"){","                        ","                    }else{","                        var yesterdayAttribute = {};","                        ","                        var userRawDataCollection = new RawDataCollection(); // 해당 사용자의 출입기록 Collection","                        userRawDataCollection.add(rawDataCollection.filterID(userId));","                        ","                        var userOutOfficeCollection = new OutOfficeCollection(); // 해당 사용자의 OutOffice Collection","                        userOutOfficeCollection.add(outOfficeCollection.where({id: userId}));","                        ","                        var userInOfficeCollection = new InOfficeCollection();","                        userInOfficeCollection.add(inOfficeCollection.where({id: userId}));","                        ","                        var filterDate = yesterdayCommuteCollection.where({id : userId}); // 시작일 - 1의 근태 데이터","                        ","                        if(filterDate.length > 0){","                            yesterdayAttribute = filterDate[0].toJSON();","                            yesterdayAttribute.out_time = Moment(yesterdayAttribute.out_time).year(yesterdayAttribute.year);","                            yesterdayAttribute.out_time = yesterdayAttribute.out_time.toDate();","                        }else{","                            yesterdayAttribute.out_time = null;","                        }","                            ","                        resultTimeFactory.init(userId, userName, userDepartment); //계산전 초기화","                        ","                        for(var i=0; i <= diff_days; i++){ //차이나는 날짜만큼 기본데이터 생성 (사원수 X 날짜)","                            var todayStr = today.format(ResultTimeFactory.DATEFORMAT);    // 오늘 날짜(str)","                            var holidayData = holidayCollection.where({ // 오늘 휴일 목록","                                date: todayStr","                            });    ","                            ","                            resultTimeFactory.initToday(todayStr, holidayData); //계산전 초기화    ","                            ","                            // 휴일 판단","                            resultTimeFactory.setHoliday();","                            ","                            // 당일 사용자의 출입기록을 보고 출근 / 퇴근/  가장 빠른,늦은시간 출입 기록을 구한다","                            var rawData = userRawDataCollection.filterDate(todayStr);","                            resultTimeFactory.checkTime(rawData);   ","                            ","                            // 출근 기준시간 판단","                            var yesterdayOutTime = _.isNull(yesterdayAttribute.out_time)? null :Moment(yesterdayAttribute.out_time, resultTimeFactory.DATETIMEFORMAT);","                            resultTimeFactory.setStandardTime(yesterdayOutTime);","                            ","                            // 휴일근무 판단","                            var todayInOffice = userInOfficeCollection.where({date:todayStr});","                            resultTimeFactory.setInOffice(todayInOffice);","                            ","                            // 휴가/외근/출장 판단","                            var todayOutOffice = userOutOfficeCollection.where({date: todayStr});","                            resultTimeFactory.setOutOffice(todayOutOffice);","                            ","                            // 결과 저장","                            var result = resultTimeFactory.getResult();","                            resultCollection.add(result);","                            ","                            // 다음날 계산을 위해 결과를 yesterdayAttribute에 저장","                            yesterdayAttribute = result;","                            ","                            today.add(1, 'days');","                        }","                    }","                });","                dfd.resolve(resultCollection.toJSON());","            });  ","            return dfd.promise();","\t\t}","\t\t","\t});","\t","\treturn ChangeHistoryPopupView;","});"]},{"start":{"row":0,"column":0},"end":{"row":197,"column":3},"action":"insert","lines":["define([ ","\t'jquery',","\t'underscore',","\t'backbone',","\t'util',","\t'cmoment',","\t'resulttimefactory',","\t'dialog',","\t'i18n!nls/common',","\t'lib/component/form',","\t'collection/common/HolidayCollection',","\t'collection/common/RawDataCollection',","\t'collection/sm/UserCollection',","\t'collection/cm/CommuteCollection',","\t'collection/vacation/OutOfficeCollection',","\t'collection/vacation/InOfficeCollection',","\t'text!templates/default/datepicker.html',","\t'text!templates/inputForm/label.html',","], function(","\t$, _, Backbone, Util, Moment, ResultTimeFactory, Dialog, i18nCommon, Form,","\tHolidayCollection, RawDataCollection, UserCollection, CommuteCollection, OutOfficeCollection, InOfficeCollection,","\tDatePickerHTML, LabelHTML",") {","\tvar resultTimeFactory = ResultTimeFactory.Builder;","\tvar ChangeHistoryPopupView = Backbone.View.extend({","\t\tinitialize : function(data) {","\t\t    if(_.isNull(data.date)){","\t\t\t    this.date = \"2015-01-01\";","\t\t    }else{","\t\t        this.date = Moment(data.date, ResultTimeFactory.DATEFORMAT).add(1,\"days\").format(ResultTimeFactory.DATEFORMAT);","\t\t    }","\t\t    ","\t\t  ","\t\t},","\t\trender : function(el) {","\t\t\tvar dfd= new $.Deferred();","            ","            if (!_.isUndefined(el)){","    \t        this.el=el;","    \t    }","    \t    var _view = this;","    \t    ","    \t    var _form = new Form({","    \t        el:_view.el,","    \t        form:undefined,","    \t         childs:[{","\t                type:\"date\",","\t                name:\"startDate\",","\t                label:i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.FORM.START_DATE,","\t                value: this.date,","\t                format:\"YYYY-MM-DD\",","\t                disabled:true,","    \t        }, {","\t                type:\"date\",","\t                name:\"endDate\",","\t                label:i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.FORM.END_DATE,","\t                format:\"YYYY-MM-DD\",","    \t        }, {","    \t        \ttype:\"text\",","    \t        \tname:\"memo\",","    \t        \tlabel:i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.FORM.TIP,","    \t        \tdisabled:true,","    \t        \tvalue: i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.FORM.TIP_TEXT","    \t        }]","    \t    });","    \t    ","    \t    _form.render().done(function(){","    \t        _view.form=_form;","    \t        dfd.resolve();","    \t    }).fail(function(){","    \t        dfd.reject();","    \t    });  ","\t    ","            return dfd.promise();","\t\t},","\t\tcreateData : function(){","    \t    var dfd = new $.Deferred();","    \t    ","    \t    var data = this.form.getData();","    \t    ","    \t    var resultCollection = new CommuteCollection();","    \t    var startDate = Moment(data.startDate, resultTimeFactory.DATEFORMAT);","            var endDate = Moment(data.endDate, resultTimeFactory.DATEFORMAT);","            var yesterday = Moment(startDate).subtract(1, 'days');","            ","            if(startDate.isAfter(endDate)){","                Dialog.error(i18nCommon.CREATE_COMMUTE_RESULT.CREATE_DIALOG.DATE_ERR_MSG);","                dfd.reject();","            }","            ","            var selectedDate = {","                start:startDate.format(ResultTimeFactory.DATEFORMAT),","                end:endDate.format(ResultTimeFactory.DATEFORMAT)","            };","            ","            var rawDataCollection = new RawDataCollection();            // 해당기간의 출입기록","            var userCollection = new UserCollection();                  // 전체 사용자 목록","            var holidayCollection = new HolidayCollection();            // 해당 연도 전체 휴일 목록","            var outOfficeCollection = new OutOfficeCollection();        // 휴가 / 외근 / 출장 목록","            var yesterdayCommuteCollection = new CommuteCollection();   // 선택일 전날 근태 데이터 목록","            var inOfficeCollection = new InOfficeCollection();","            ","            $.when(","                rawDataCollection.fetch({data: { start : selectedDate.start, end:Moment(endDate).add(1,\"days\").format(ResultTimeFactory.DATEFORMAT) }}),","                userCollection.fetch(),","                holidayCollection.fetch({ data : {  year : startDate.year() } }),","                outOfficeCollection.fetch({data : selectedDate}),","                inOfficeCollection.fetch({data : selectedDate}),","                yesterdayCommuteCollection.fetchDate(yesterday.format(ResultTimeFactory.DATEFORMAT))","            ).done(function(){","                var diff_days = endDate.diff(startDate, 'days');","","                _.each(userCollection.models, function(userModel, idx){     // 사용자별로 데이터 생성","                    var today = Moment(startDate);","                    var userId = userModel.attributes.id;","                    var userName = userModel.attributes.name;","                    var userDepartment = userModel.attributes.dept_name;","                    var leaveCompany = userModel.attributes.leave_company;","                    if(_.isString(leaveCompany)){","\t\t\t\t\t\tleaveCompany = leaveCompany.trim();","\t\t\t\t\t}","                    if( userDepartment == \"무소속\"","                        || userDepartment == \"임원\"","                        || !_.isNull(leaveCompany)","                        || leaveCompany != \"\"","                        || userName.slice(0,3) == \"테스트\"){","                        ","                    }else{","                        var yesterdayAttribute = {};","                        ","                        var userRawDataCollection = new RawDataCollection(); // 해당 사용자의 출입기록 Collection","                        userRawDataCollection.add(rawDataCollection.filterID(userId));","                        ","                        var userOutOfficeCollection = new OutOfficeCollection(); // 해당 사용자의 OutOffice Collection","                        userOutOfficeCollection.add(outOfficeCollection.where({id: userId}));","                        ","                        var userInOfficeCollection = new InOfficeCollection();","                        userInOfficeCollection.add(inOfficeCollection.where({id: userId}));","                        ","                        var filterDate = yesterdayCommuteCollection.where({id : userId}); // 시작일 - 1의 근태 데이터","                        ","                        if(filterDate.length > 0){","                            yesterdayAttribute = filterDate[0].toJSON();","                            yesterdayAttribute.out_time = Moment(yesterdayAttribute.out_time).year(yesterdayAttribute.year);","                            yesterdayAttribute.out_time = yesterdayAttribute.out_time.toDate();","                        }else{","                            yesterdayAttribute.out_time = null;","                        }","                            ","                        resultTimeFactory.init(userId, userName, userDepartment); //계산전 초기화","                        ","                        for(var i=0; i <= diff_days; i++){ //차이나는 날짜만큼 기본데이터 생성 (사원수 X 날짜)","                            var todayStr = today.format(ResultTimeFactory.DATEFORMAT);    // 오늘 날짜(str)","                            var holidayData = holidayCollection.where({ // 오늘 휴일 목록","                                date: todayStr","                            });    ","                            ","                            resultTimeFactory.initToday(todayStr, holidayData); //계산전 초기화    ","                            ","                            // 휴일 판단","                            resultTimeFactory.setHoliday();","                            ","                            // 당일 사용자의 출입기록을 보고 출근 / 퇴근/  가장 빠른,늦은시간 출입 기록을 구한다","                            var rawData = userRawDataCollection.filterDate(todayStr);","                            resultTimeFactory.checkTime(rawData);   ","                            ","                            // 출근 기준시간 판단","                            var yesterdayOutTime = _.isNull(yesterdayAttribute.out_time)? null :Moment(yesterdayAttribute.out_time, resultTimeFactory.DATETIMEFORMAT);","                            resultTimeFactory.setStandardTime(yesterdayOutTime);","                            ","                            // 휴일근무 판단","                            var todayInOffice = userInOfficeCollection.where({date:todayStr});","                            resultTimeFactory.setInOffice(todayInOffice);","                            ","                            // 휴가/외근/출장 판단","                            var todayOutOffice = userOutOfficeCollection.where({date: todayStr});","                            resultTimeFactory.setOutOffice(todayOutOffice);","                            ","                            // 결과 저장","                            var result = resultTimeFactory.getResult();","                            resultCollection.add(result);","                            ","                            // 다음날 계산을 위해 결과를 yesterdayAttribute에 저장","                            yesterdayAttribute = result;","                            ","                            today.add(1, 'days');","                        }","                    }","                });","                dfd.resolve(resultCollection.toJSON());","            });  ","            return dfd.promise();","\t\t}","\t\t","\t});","\t","\treturn ChangeHistoryPopupView;","});"]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":27},"end":{"row":123,"column":28},"action":"insert","lines":["("]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":51},"end":{"row":123,"column":52},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":52},"end":{"row":123,"column":53},"action":"insert","lines":["&"]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":53},"end":{"row":123,"column":54},"action":"insert","lines":["&"]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":124,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":["|"]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":54},"end":{"row":123,"column":55},"action":"remove","lines":["|"]}]}],[{"group":"doc","deltas":[{"start":{"row":123,"column":73},"end":{"row":123,"column":74},"action":"insert","lines":[")"]}]}]]},"ace":{"folds":[],"scrolltop":850,"scrollleft":0,"selection":{"start":{"row":86,"column":54},"end":{"row":86,"column":54},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":77,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1426479452000,"hash":"20244016738b1e57ce3dac145e54eddb51eff606"}