<querys>
    <group id="user">
        <query id="selectUserList">
        	SELECT 
        		id, name, dept_code, (SELECT name FROM dept_code_tbl where code = dept_code) dept_name, name_commute, join_company, leave_company, privilege, admin
        	FROM members_tbl
        </query>
        <query id="selectIdByUser">select * from members_tbl where id=?</query>
        <query id="insertUser">insert into members_tbl(id, name, dept_code, name_commute, join_company, privilege, admin) values(?,?,?,?,?, 0, 0)</query>
        <query id="initPassword">update members_tbl set password=? where id=?</query>
        <query id="deleteUser">delete from members_tbl where id=?</query>
    </group>
    
    <group id="data">
        <query id="select_user_all">select * from members_tbl</query>
    </group>
    
    <group id="dept">
        <query id="selectDeptList">SELECT code, name FROM dept_code_tbl</query>
        <query id="selectDeptList1">SELECT code, name FROM dept_code_tbl</query>
    </group>
    
    <group id="rawData">
        <query id="insertRawData">insert into commute_base_tbl(id, name, department, int_date, char_date, year, type) values(?,?,?,?,?,?,?)</query>
        <query id="selectRawDataList">select * from commute_base_tbl where time between ? and ? </query>
    </group>
    
    <group id="holiday">
        <query id="selectHolidayYearList">select distinct year from holiday_tbl</query>
        <query id="selectHolidayList">select * from holiday_tbl where year=?</query>
        <query id="insertHoliday">insert into holiday_tbl(year, date, memo) values(?, ?, ?)</query>
        <query id="deleteHoliday">delete from holiday_tbl where year=? and date=?</query>
	</group>
	
    <group id="vacation">
        <query id="selectVacationsByYear">
			SELECT 
				m.id, 
			    m.name,
			    (SELECT name FROM dept_code_tbl where code = m.dept_code) dept_name,
			    m.join_company,
				t2.year,
				t2.id,
				t2.total_day,
				t2.used_holiday,
			    (t2.total_day - t2.used_holiday) holiday
			FROM
				members_tbl m
			    INNER JOIN (
							SELECT
								v.year,
								v.id,
								v.total_day,
								IFNULL(s.used_holiday, 0) used_holiday
							FROM
								vacation_tbl v
								LEFT JOIN (
											SELECT year, id, sum(day_count)  used_holiday
											FROM out_office_tbl
											GROUP BY year, id
											) s
								ON v.id = s.id and v.year = s.year
							WHERE v.year = ?
			    ) t2
			    ON m.id = t2.id
			ORDER BY m.name
        </query>
        <query id="selectVacatonCount">
			SELECT count(*) count FROM vacation_tbl WHERE year = ?
        </query>
        
        <query id="insertVacation">
			INSERT INTO vacation_tbl(id, year, total_day)
			SELECT ?, ?, ? from dual
			WHERE NOT EXISTS (
					SELECT id
					FROM vacation_tbl
					WHERE 
						id = ?
			        AND 
			        	year = ? 
			)
        </query>

        <query id="updateVacation">
        	UPDATE 
        		vacation_tbl 
        	SET 
        		total_day = ? 
        	WHERE 
        		id = ? AND year = ?
        </query>
    </group>
    
    <group id="approval">
        <query id="selectApprovalList">
        	select 
        		app.doc_num
        		, app.submit_id
        		, (SELECT mem.name FROM members_tbl mem WHERE mem.id = app.submit_id) submit_name
        		, app.manager_id
        		, (SELECT mem.name FROM members_tbl mem WHERE mem.id = app.manager_id) manager_name
        		, submit_date
        		, decide_date
        		, submit_comment
        		, decide_comment
        		, start_date
        		, end_date
        		, office_code
        		, (SELECT office.name FROM office_code_tbl office WHERE office.code = app.office_code) office_code_name
        		, state
    		from 
    			approval_tbl app
		</query>
        <query id="selectOfficeCodeList">select * from office_code_tbl</query>
	</group>
</querys>